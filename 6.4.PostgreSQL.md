## Arsalan DEVOPS-24

### 6.4. PostgreSQL.

#### Задача 1
Используя docker поднимите инстанс PostgreSQL (версию 13). Данные БД сохраните в volume.

Подключитесь к БД PostgreSQL используя psql.

Воспользуйтесь командой \? для вывода подсказки по имеющимся в psql управляющим командам.

Найдите и приведите управляющие команды для:

* вывода списка БД
* подключения к БД
* вывода списка таблиц
* вывода описания содержимого таблиц
* выхода из psql


<details>
<summary>Ответ</summary>

![task1_1.png](64%2Ftask1_1.png)
![task1_2.png](64%2Ftask1_2.png)
![task1_3.png](64%2Ftask1_3.png)
![task1_4.png](64%2Ftask1_4.png)
</details>

#### Задача 2
Используя psql создайте БД test_database.

Изучите бэкап БД.

Восстановите бэкап БД в test_database.

Перейдите в управляющую консоль psql внутри контейнера.

Подключитесь к восстановленной БД и проведите операцию ANALYZE для сбора статистики по таблице.

Используя таблицу pg_stats, найдите столбец таблицы orders с наибольшим средним значением размера элементов в байтах.

Приведите в ответе команду, которую вы использовали для вычисления и полученный результат.

<details>
<summary>Ответ</summary>

![task2_1.png](64%2Ftask2_1.png)
![task2_2.png](64%2Ftask2_2.png)
</details>

#### Задача 3
Архитектор и администратор БД выяснили, что ваша таблица orders разрослась до невиданных размеров и поиск по ней занимает долгое время. Вам, как успешному выпускнику курсов DevOps в нетологии предложили провести разбиение таблицы на 2 (шардировать на orders_1 - price>499 и orders_2 - price<=499).

Предложите SQL-транзакцию для проведения данной операции.

Можно ли было изначально исключить "ручное" разбиение при проектировании таблицы orders?

<details>
<summary>Ответ</summary>

```commandline
CREATE TABLE orders_1 (CHECK (price < 499)) INHERITS (orders);
CREATE TABLE orders_2 (CHECK (price >= 499)) INHERITS (orders);
```

Создал функцию и триггер, по идее в функции один IF лишний

![task3_1.png](64%2Ftask3_1.png)
![task3_1.png](64%2Ftask3_2.png)

</details>

#### Задача 4

<details>
<summary>Ответ</summary>

![task4_1.png](64%2Ftask4_1.png)
![task4_2.png](64%2Ftask4_2.png)
![task4_3.png](64%2Ftask4_3.png)
</details>